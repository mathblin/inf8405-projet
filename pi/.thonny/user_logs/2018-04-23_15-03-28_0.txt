[
    {
        "editor_id": 1970662672,
        "editor_class": "Editor",
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1970735344,
        "time": "2018-04-23T15:03:28.827054",
        "sequence": "EditorTextCreated"
    },
    {
        "editor_id": 1970662672,
        "sequence": "Open",
        "editor_class": "Editor",
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1970735344,
        "time": "2018-04-23T15:03:28.829530",
        "filename": "/home/pi/Desktop/platoon/INF8405/RaspberryPi/server/platoon.py"
    },
    {
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1970735344,
        "index2": "2.0",
        "index1": "1.0",
        "time": "2018-04-23T15:03:28.830563",
        "sequence": "TextDelete"
    },
    {
        "text": "#!/usr/bin/env python\nimport RPi.GPIO as GPIO\nimport track_2\nLedPin   = 20\nTouchPin = 17\nledBlue =  16\n\ndef setup():\n        GPIO.setmode(GPIO.BCM)       # Numbers GPIOs by physical location\n        GPIO.setup(LedPin, GPIO.OUT)   # Set LedPin's mode is output\n        GPIO.setup(ledBlue, GPIO.OUT) \n        GPIO.setup(TouchPin, GPIO.IN, pull_up_down=GPIO.PUD_UP)\n        GPIO.output(ledBlue, GPIO.HIGH)\ndef loop():\n        while True:\n                if GPIO.input(TouchPin) == GPIO.HIGH:\n                        GPIO.output(ledBlue, GPIO.LOW)\n                        GPIO.output(LedPin, GPIO.HIGH) # led off\n                        track_2.main()\n\n\ndef destroy():\n        GPIO.output(LedPin, GPIO.LOW)     # led off\n        GPIO.cleanup()                     # Release resource\n\nif __name__ == '__main__':     # Program start from here\n        setup()\n        try:\n                loop()\n        except KeyboardInterrupt:  # When 'Ctrl+C' is pressed, the child program destroy() will be  executed.\n                destroy()\n",
        "index": "1.0",
        "text_widget_class": "CodeViewText",
        "sequence": "TextInsert",
        "tags": "()",
        "time": "2018-04-23T15:03:29.008996",
        "text_widget_id": 1970735344
    },
    {
        "view_id": "ShellView",
        "view_class": "ShellView",
        "time": "2018-04-23T15:03:29.043101",
        "sequence": "ShowView"
    },
    {
        "sequence": "<FocusIn>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:03:30.151512",
        "widget_id": 1983614192
    },
    {
        "text_widget_context": "shell",
        "text": "Python 3.5.3 (/usr/bin/python3)",
        "tags": "('welcome',)",
        "text_widget_class": "ShellText",
        "sequence": "TextInsert",
        "index": "1.0",
        "time": "2018-04-23T15:03:30.187345",
        "text_widget_id": 1970607664
    },
    {
        "text_widget_context": "shell",
        "text": "\n",
        "tags": "('io',)",
        "text_widget_class": "ShellText",
        "sequence": "TextInsert",
        "index": "1.31",
        "time": "2018-04-23T15:03:30.193515",
        "text_widget_id": 1970607664
    },
    {
        "text_widget_context": "shell",
        "text": ">>> ",
        "tags": "('toplevel', 'prompt')",
        "text_widget_class": "ShellText",
        "sequence": "TextInsert",
        "index": "2.0",
        "time": "2018-04-23T15:03:30.196149",
        "text_widget_id": 1970607664
    },
    {
        "editor_id": 1952116720,
        "editor_class": "Editor",
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:03:31.424409",
        "sequence": "EditorTextCreated"
    },
    {
        "editor_id": 1952116720,
        "sequence": "Open",
        "editor_class": "Editor",
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:03:31.426832",
        "filename": "/home/pi/Desktop/platoon/INF8405/RaspberryPi/server/track_2.py"
    },
    {
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "index2": "2.0",
        "index1": "1.0",
        "time": "2018-04-23T15:03:31.427934",
        "sequence": "TextDelete"
    },
    {
        "text": "import numpy as np\nimport argparse\nimport cv2\nimport time\nimport serial\nimport threading\nimport math\nfrom enum import Enum\nfrom Import.sonar import SonarThread\n# initialize the current frame of the video, along with the list of\n# ROI points along with whether or not this is input mode\nframe = None\nroiPts = [(189,101), (192, 298), (411, 302), (408, 105)]\ninputMode = False\nisInit = []\nisInit.append(False)\nwidth = 640\nheight = 480\ncurrentState = 2\nserial = serial.Serial('/dev/serial/by-id/usb-FTDI_FT232R_USB_UART_A100Q21Z-if00-port0')\ncounterW = 5\n\n\nclass turningState():\n\tTS0 = 0\n\tTS1 = 1\n\tTS2 = 2\n\tTS3 = 3\n\tTS4 = 4\n\nturningState = turningState()\n\ndef init(frame):\n\tglobal roiHist, roiBox, roiPts, isInit\n\torig = frame.copy()\n\n\t# determine the top-left and bottom-right points\n\troiPts = np.array(roiPts)\n\ts = roiPts.sum(axis = 1)\n\ttl = roiPts[np.argmin(s)]\n\tbr = roiPts[np.argmax(s)]\n\n\t# grab the ROI for the bounding box and convert it\n\t# to the HSV color space\n\troi = orig[tl[1]:br[1], tl[0]:br[0]]\n\troi = cv2.cvtColor(roi, cv2.COLOR_BGR2HSV)\n\t#roi = cv2.cvtColor(roi, cv2.COLOR_BGR2LAB)\n\n\t# compute a HSV histogram for the ROI and store the\n\t# bounding box\n\troiHist = cv2.calcHist([roi], [0], None, [16], [0, 180])\n\troiHist = cv2.normalize(roiHist, roiHist, 0, 255, cv2.NORM_MINMAX)\n\troiBox = (tl[0], tl[1], br[0], br[1])\n\tisInit[0] = True\n\n\ndef main():\n\t# construct the argument parse and parse the arguments\n\tap = argparse.ArgumentParser()\n\tap.add_argument(\"-v\", \"--video\",\n\t\thelp = \"path to the (optional) video file\")\n\targs = vars(ap.parse_args())\n\n\t# grab the reference to the current frame, list of ROI\n\t# points and whether or not it is ROI selection mode\n\tglobal frame, roiPts, inputMode, roiBox, isInit\n\t\n\tcamera = cv2.VideoCapture(0)\n\n\t# setup the mouse callback\n\t#cv2.namedWindow(\"frame\")\n\t\n\t# initialize the termination criteria for cam shift, indicating\n\t# a maximum of ten iterations or movement by a least one pixel\n\t# along with the bounding box of the ROI\n\ttermination = (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, 10, 1)\n\t#counter = 0\n\tSTOP_DISTANCE = 20.0\n\tDistanceList = []\n\tconList = []\n\tconList.append('ok')\n\tsonar = SonarThread(serial, conList, DistanceList, None, isInit)\n\tsonar.setDaemon(True)\t\n\t\n\twhile True:\n\t\tif isInit[0]:\n\t\t\t# grab the current frame\n\t\t\t(grabbed, readFrame) = camera.read()\n\t\t\tframe = cv2.flip(readFrame, -1)\n\t\t\t# check to see if we have reached the end of the\n\t\t\t# video\n\t\t\tif not grabbed:\n\t\t\t\tbreak\n\n\t\t\t# if the see if the ROI has been computed\n\t\t\tif roiBox is not None:\n\t\t\t\t# convert the current frame to the HSV color space\n\t\t\t\t# and perform mean shift\n\t\t\t\thsv = cv2.cvtColor(frame, cv2.COLOR_BGR2HSV)\n\t\t\t\tbackProj = cv2.calcBackProject([hsv], [0], roiHist, [0, 180], 1)\n\n\t\t\t\t# apply cam shift to the back projection, convert the\n\t\t\t\t# points to a bounding box, and then draw them\n\t\t\t\t(r, roiBox) = cv2.CamShift(backProj, roiBox, termination)\n\t\t\t\tpts = np.int0(cv2.boxPoints(r))\n\t\t\t\tif DistanceList and DistanceList[0] <= STOP_DISTANCE:\n\t\t\t\t\tserial.write('x'.encode())\n\t\t\t\t\t#print(\"Distance: \" + str(DistanceList[0]))\n\t\t\t\t\tcontinue\n\t\t\t\tmoveRobot(pts)\n\t\t\t\t\n\t\t\t\tcv2.polylines(frame, [pts], True, (0, 255, 0), 2)\n\n\t\t\t# show the frame and record if the user presses a key\n\t\t\t#cv2.imshow(\"frame\",frame)\n\t\t\tkey = cv2.waitKey(1) & 0xFF\n\n\t\t\tif key == ord(\"q\"):\n\t\t\t\tserial.write('x'.encode())\n\t\t\t\tbreak\n\t\telse:\n\t\t\t(grabbed, readFrame) = camera.read()\n\t\t\tframeInit = cv2.flip(readFrame, -1)\n\t\t\tinit(frameInit)\n\t\t\tsonar.start()\n\n\tcamera.release()\n\tcv2.destroyAllWindows()\n\tsonar.stop()\n\tsonar.join()\n\ndef getMinMax(pts):\n\tptMax = pts[0]\n\tptMin = pts[0]\n\tfor pt in pts:\n\t\tif pt[0] < ptMin[0] and pt[1] < ptMin[0] :\n\t\t\tptMin = pt\n\t\tif pt[0] > ptMax[0] and pt[1] > ptMax[1]:\n\t\t\tptMax = pt\n\treturn ptMin, ptMax\n\ndef moveRobot(pts):\n\tglobal width, height, turningState, currentState, counterW\n\tptMin, ptMax = getMinMax(pts)\n\t#print(\"ptMin\")\n\t#print(ptMin)\n\t#print(\"ptMax\")\n\t#print(ptMax)\n\tincX = int((ptMax[0] - ptMin[0])/2)\n\tincY = int((ptMax[1] - ptMin[1])/2)\n\tptMilieu = [ptMin[0] + incX, ptMin[1] + incY]\n\n\tif currentState == turningState.TS0:\n\t\tif ptMilieu[0] > 128:\n\t\t\tcurrentState = turningState.TS1\n\t\tserial.write(\"Q\".encode())\n\telif currentState == turningState.TS1:\n\t\tif ptMilieu[0] < 128:\n\t\t\tcurrentState = turningState.TS0\n\t\telif ptMilieu[0] > 256:\n\t\t\tcurrentState = turningState.TS2\n\t\tserial.write(\"Q\".encode())\n\telif currentState == turningState.TS2:\n\t\tif ptMilieu[0] < 256:\n\t\t\tcurrentState = turningState.TS1\n\t\telif ptMilieu[0] > 384:\n\t\t\tcurrentState = turningState.TS3\n\t\tif (int(math.sqrt(((ptMax[0] - ptMin[0]) ** 2) + ((ptMax[1] - ptMin[1]) ** 2))) < 250 and int(math.sqrt(((ptMax[0] - ptMin[0]) ** 2) + ((ptMax[1] - ptMin[1]) ** 2))) > 50):\n\t\t\tif counterW >= 5:\n\t\t\t\tserial.write(\"W\".encode())\n\t\t\t\tcounterW = 0\n\t\t\telse:\n\t\t\t\t counterW = counterW + 1\n\t\telse:\n\t\t\tserial.write(\"x\".encode())\n\telif currentState == turningState.TS3:\n\t\tif ptMilieu[0] < 384:\n\t\t\tcurrentState = turningState.TS2\n\t\telif ptMilieu[0] > 512:\n\t\t\tcurrentState = turningState.TS4\n\t\tserial.write(\"E\".encode())\n\telif currentState == turningState.TS4:\n\t\tif ptMilieu[0] < 512:\n\t\t\tcurrentState = turningState.TS3\n\t\tserial.write(\"E\".encode())\n\t#if(ptMilieu[0] < int(width/2) - 20):\n\t#\tprint(\"q\")\n\t#\tserial.write(\"Q\".encode())\n\t#elif(ptMilieu[0] > int(width/2) + 20):\n\t#\tprint(\"e\")\n\t#\tserial.write(\"E\".encode())\n\t\n\t\n\t#string = 'w'\n\t#serial.write(string.encode())\n\nif __name__ == \"__main__\":\n\tmain()\ni",
        "index": "1.0",
        "text_widget_class": "CodeViewText",
        "sequence": "TextInsert",
        "tags": "()",
        "time": "2018-04-23T15:03:31.470723",
        "text_widget_id": 1952115888
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1970735344,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1970735344,
        "time": "2018-04-23T15:03:31.569167",
        "sequence": "<Button-1>"
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1952115888,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:03:36.216660",
        "sequence": "<Button-1>"
    },
    {
        "sequence": "<FocusOut>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:03:54.393958",
        "widget_id": 1983614192
    },
    {
        "sequence": "<FocusIn>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:03:56.689488",
        "widget_id": 1983614192
    },
    {
        "sequence": "<FocusOut>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:03:58.679774",
        "widget_id": 1983614192
    },
    {
        "sequence": "<FocusIn>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:04:02.621508",
        "widget_id": 1983614192
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1952115888,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:04:02.750500",
        "sequence": "<Button-1>"
    },
    {
        "widget": ".#1971822352",
        "time": "2018-04-23T15:04:29.158577",
        "sequence": "<Button-1>"
    },
    {
        "sequence": "<FocusOut>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:04:29.250212",
        "widget_id": 1983614192
    },
    {
        "widget": ".#1971822352.#1971822352#1971122064",
        "time": "2018-04-23T15:04:35.019373",
        "sequence": "<Button-1>"
    },
    {
        "sequence": "<FocusIn>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:04:35.244572",
        "widget_id": 1983614192
    },
    {
        "sequence": "<FocusOut>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:04:35.434272",
        "widget_id": 1983614192
    },
    {
        "sequence": "<Button-1>",
        "widget_class": "Checkbutton",
        "time": "2018-04-23T15:04:40.419284",
        "widget_id": 1931225072
    },
    {
        "sequence": "<Button-1>",
        "widget_class": "Button",
        "time": "2018-04-23T15:04:41.441340",
        "widget_id": 1952113904
    },
    {
        "command_id": "show_options",
        "denied": "False",
        "time": "2018-04-23T15:04:41.560656",
        "sequence": "Command"
    },
    {
        "sequence": "<FocusIn>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:04:42.591426",
        "widget_id": 1983614192
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1952115888,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:04:47.226291",
        "sequence": "<Button-1>"
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1952115888,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:04:50.263771",
        "sequence": "<Button-1>"
    },
    {
        "command_id": "OpenFindDialog",
        "denied": "False",
        "time": "2018-04-23T15:04:51.599594",
        "sequence": "Command"
    },
    {
        "sequence": "<FocusOut>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:04:51.801316",
        "widget_id": 1983614192
    },
    {
        "sequence": "<FocusIn>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:05:26.814559",
        "widget_id": 1983614192
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1952115888,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:05:26.961226",
        "sequence": "<Button-1>"
    },
    {
        "sequence": "<FocusOut>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:05:28.406385",
        "widget_id": 1983614192
    },
    {
        "sequence": "<FocusIn>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:05:32.221629",
        "widget_id": 1983614192
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1952115888,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:05:32.339433",
        "sequence": "<Button-1>"
    },
    {
        "sequence": "<FocusOut>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:05:34.352839",
        "widget_id": 1983614192
    },
    {
        "sequence": "<FocusIn>",
        "widget_class": "Workbench",
        "time": "2018-04-23T15:05:43.932970",
        "widget_id": 1983614192
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1952115888,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:05:44.062332",
        "sequence": "<Button-1>"
    },
    {
        "widget_class": "CodeViewText",
        "widget_id": 1952115888,
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:05:49.871890",
        "sequence": "<Button-1>"
    },
    {
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "index2": "None",
        "index1": "199.0",
        "time": "2018-04-23T15:05:50.969106",
        "sequence": "TextDelete"
    },
    {
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "index2": "None",
        "index1": "198.7",
        "time": "2018-04-23T15:05:51.517859",
        "sequence": "TextDelete"
    },
    {
        "editor_id": 1952116720,
        "sequence": "Save",
        "editor_class": "Editor",
        "text_widget_class": "CodeViewText",
        "text_widget_id": 1952115888,
        "time": "2018-04-23T15:05:52.325957",
        "filename": "/home/pi/Desktop/platoon/INF8405/RaspberryPi/server/track_2.py"
    },
    {
        "command_id": "save_file",
        "denied": "False",
        "time": "2018-04-23T15:05:52.334827",
        "sequence": "Command"
    }
]